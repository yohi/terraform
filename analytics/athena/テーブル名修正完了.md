# Athena Analytics テーブル名修正完了

## 修正内容

### 問題
- Terraformで期待するテーブル名と実際にGlue Crawlerが作成するテーブル名が不一致
- SQLクエリ実行時にテーブルが見つからないエラーが発生

### 修正内容

1. **Glue Crawlerの設定修正**
   - `table_prefix = "${local.project_env}-"` を復活
   - テーブル名の一貫性を確保

2. **SQLテンプレートの修正**
   - `create_view.sql` で不正な3部構成テーブル名参照を修正
   - `"${catalog_name}"."${database_name}"."${table_name}"` → `${database_name}."${table_name}"`

## テーブル名の命名規則

### 実際に作成されるテーブル名
```
${project}-${env}-${table_name_suffix}
```

**例:**
- `rcs-prd-django_web`
- `rcs-prd-nginx_web`
- `rcs-prd-error`

### データベース名
```
${project}_${env}_${app}_logs
```

**例:**
- `rcs_prd_web_logs`

## 使用方法

1. **Terraform Apply実行**
   ```bash
   cd analytics/athena/terraform
   terraform plan
   terraform apply
   ```

2. **クエリ実行**
   - Athenaコンソールで作成されたNamed Queriesを実行
   - 正しいテーブル名で参照されるため、エラーなく実行可能

## 注意事項

- テーブル名は自動生成されるため、手動変更は推奨されません
- 新しいログタイプを追加する場合は、`variables.tf`の`log_types`に追加してください
- クエリを直接記述する場合は、上記の命名規則に従ってください

## 確認方法

1. **テーブル存在確認**
   ```sql
   SHOW TABLES IN your_database_name;
   ```

2. **サンプルクエリ実行**
   ```sql
   SELECT COUNT(*) FROM your_database_name."rcs-prd-django_web" LIMIT 10;
   ```
