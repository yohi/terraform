# ğŸ”„ EC2 Auto Scaling Group Terraform Module

**æœ€æ–°ã®æ›´æ–°**: 2024å¹´12æœˆ - å®Œå…¨å‹•ä½œç¢ºèªæ¸ˆã¿

é«˜å¯ç”¨æ€§ã¨ã‚³ã‚¹ãƒˆåŠ¹ç‡ã‚’ä¸¡ç«‹ã™ã‚‹EC2ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®è‡ªå‹•ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ç’°å¢ƒã‚’æ§‹ç¯‰ã™ã‚‹Terraformãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã§ã™ã€‚

## ğŸ“‹ æ¦‚è¦

ã“ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¯ã€CPUä½¿ç”¨ç‡ã‚„ã‚«ã‚¹ã‚¿ãƒ ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã«åŸºã¥ã„ã¦è‡ªå‹•çš„ã«ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹æ•°ã‚’èª¿æ•´ã—ã€å®‰å®šã—ãŸã‚µãƒ¼ãƒ“ã‚¹æä¾›ã‚’å®Ÿç¾ã—ã¾ã™ã€‚é–‹ç™ºç’°å¢ƒã§ã®ã‚³ã‚¹ãƒˆæœ€é©åŒ–ï¼ˆ0å°ã‚¹ã‚±ãƒ¼ãƒ«ãƒ€ã‚¦ãƒ³ï¼‰ã‹ã‚‰æœ¬ç•ªç’°å¢ƒã§ã®é«˜å¯ç”¨æ€§ç¢ºä¿ã¾ã§ã€å¹…åºƒã„è¦ä»¶ã«å¯¾å¿œã—ã¾ã™ã€‚

## âœ¨ 2024å¹´12æœˆã®ç‰¹å¾´

### ğŸ”„ **ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°æ©Ÿèƒ½**
- âœ… **ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥** - ã‚¼ãƒ­ãƒ€ã‚¦ãƒ³ã‚¿ã‚¤ãƒ ãƒ­ãƒ¼ãƒªãƒ³ã‚°æ›´æ–°
- âœ… **é«˜åº¦ãªã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°** - ã‚¿ãƒ¼ã‚²ãƒƒãƒˆè¿½è·¡ãƒ»ã‚¹ãƒ†ãƒƒãƒ—ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°
- âœ… **å®Œå…¨ã‚¹ã‚±ãƒ¼ãƒ«ãƒ€ã‚¦ãƒ³** - é–‹ç™ºç’°å¢ƒã§0å°ã¾ã§ç¸®å°å¯èƒ½

### ğŸ·ï¸ **çµ±åˆç®¡ç†**
- âœ… **çµ±ä¸€ã‚¿ã‚°æˆ¦ç•¥** - ç’°å¢ƒãƒ»ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ»é‹ç”¨ã‚¿ã‚°è‡ªå‹•é©ç”¨
- âœ… **æŸ”è»Ÿãªãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯** - VPCãƒ»ã‚µãƒ–ãƒãƒƒãƒˆè‡ªå‹•é¸æŠ/ã‚«ã‚¹ã‚¿ãƒ æŒ‡å®š
- âœ… **å‹•ä½œç¢ºèªæ¸ˆã¿** - Terraform 1.0+, AWS Provider 5.x

### ğŸ”” **ç›£è¦–ãƒ»ã‚¢ãƒ©ãƒ¼ãƒˆ**
- âœ… **åŒ…æ‹¬çš„ã‚¢ãƒ©ãƒ¼ãƒ ** - 4ç¨®é¡ã®CloudWatchã‚¢ãƒ©ãƒ¼ãƒ 
- âœ… **SNSé€šçŸ¥çµ±åˆ** - ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ã‚¤ãƒ™ãƒ³ãƒˆé€šçŸ¥
- âœ… **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¼·åŒ–** - KMSæš—å·åŒ–ã€å…¥åŠ›ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³

## ğŸ—ï¸ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              Auto Scaling Group                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚                      â”‚                      â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   Launch Template â”‚   â”‚  Scaling Policy  â”‚   â”‚   CloudWatch     â”‚
        â”‚                   â”‚   â”‚                  â”‚   â”‚                  â”‚
        â”‚ â”œâ”€ AMI           â”‚   â”‚ â”œâ”€ Target Track  â”‚   â”‚ â”œâ”€ CPU High      â”‚
        â”‚ â”œâ”€ Instance Type â”‚   â”‚ â”œâ”€ Step Scaling  â”‚   â”‚ â”œâ”€ CPU Low       â”‚
        â”‚ â”œâ”€ Security Groupâ”‚   â”‚ â”œâ”€ Simple Scale  â”‚   â”‚ â”œâ”€ Scale Up      â”‚
        â”‚ â””â”€ User Data     â”‚   â”‚ â””â”€ Cooldown      â”‚   â”‚ â””â”€ Scale Down    â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚                      â”‚                      â”‚
                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                   â”‚                   â”‚
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚   EC2 Instances  â”‚ â”‚   Target Groups  â”‚ â”‚   SNS Topics     â”‚
           â”‚                  â”‚ â”‚                  â”‚ â”‚                  â”‚
           â”‚ â”œâ”€ Multi-AZ      â”‚ â”‚ â”œâ”€ Health Check  â”‚ â”‚ â”œâ”€ Email Alerts  â”‚
           â”‚ â”œâ”€ Auto Replace  â”‚ â”‚ â”œâ”€ Load Balance  â”‚ â”‚ â”œâ”€ Webhook       â”‚
           â”‚ â””â”€ Instance Warm â”‚ â”‚ â””â”€ Deregister   â”‚ â”‚ â””â”€ Slack/Teams   â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸš€ ä¸»è¦æ©Ÿèƒ½

### ğŸ”„ **ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°æ©Ÿèƒ½**
- **Auto Scaling Group** - è‡ªå‹•ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ï¼ˆå‘½åè¦å‰‡: `${project}-${env}-${app}-asg`ï¼‰
- **ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ãƒãƒªã‚·ãƒ¼**:
  - ğŸ¯ **ã‚¿ãƒ¼ã‚²ãƒƒãƒˆè¿½è·¡ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°** - CPUä½¿ç”¨ç‡ç›®æ¨™å€¤ç¶­æŒ
  - ğŸ“Š **ã‚¹ãƒ†ãƒƒãƒ—ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°** - æ®µéšçš„ãªèª¿æ•´
  - ğŸ”„ **ã‚·ãƒ³ãƒ—ãƒ«ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°** - åŸºæœ¬çš„ãªå¢—æ¸›

### ğŸ”„ **ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ç®¡ç†**
- **ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥** - èµ·å‹•ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå¤‰æ›´æ™‚ã®è‡ªå‹•æ›´æ–°
- **ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯** - EC2/ELBãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯å¯¾å¿œ
- **ã‚¦ã‚©ãƒ¼ãƒ ã‚¢ãƒƒãƒ—** - æ®µéšçš„ãªè² è·åˆ†æ•£

### ğŸ”” **ç›£è¦–ãƒ»ã‚¢ãƒ©ãƒ¼ãƒˆ**
- **CloudWatch Alarms** - 4ç¨®é¡ã®ã‚¢ãƒ©ãƒ¼ãƒ ï¼ˆCPU High/Lowã€Scale Up/Downï¼‰
- **SNSé€šçŸ¥** - ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ã‚¤ãƒ™ãƒ³ãƒˆé€šçŸ¥
- **è©³ç´°ãƒ¡ãƒˆãƒªã‚¯ã‚¹** - é«˜åº¦ãªç›£è¦–è¨­å®š

## ğŸ”§ å‰ææ¡ä»¶

### ğŸ“‹ å¿…è¦ãªç’°å¢ƒ

| è¦ä»¶             | ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | èª¬æ˜                 |
| ---------------- | ---------- | -------------------- |
| **Terraform**    | >= 1.0     | æœ€æ–°ã®æ§‹æ–‡ãƒ»æ©Ÿèƒ½å¯¾å¿œ |
| **AWS Provider** | >= 5.0     | æœ€æ–°ã®AWSæ©Ÿèƒ½        |
| **AWS CLI**      | >= 2.0     | èªè¨¼ãƒ»è¨­å®šç¢ºèª       |

### ğŸ“¦ äº‹å‰ä½œæˆãƒªã‚½ãƒ¼ã‚¹

| ãƒªã‚½ãƒ¼ã‚¹             | å¿…é ˆ | èª¬æ˜                              |
| -------------------- | ---- | --------------------------------- |
| **èµ·å‹•ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ** | âœ…    | EC2ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®è¨­å®š             |
| **VPCãƒ»ã‚µãƒ–ãƒãƒƒãƒˆ**  | âŒ    | æŒ‡å®šãªã—ã®å ´åˆã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆVPCä½¿ç”¨ |
| **IAMãƒ­ãƒ¼ãƒ«**        | âŒ    | é©åˆ‡ãªæ¨©é™è¨­å®šæ¨å¥¨                |
| **ã‚­ãƒ¼ãƒšã‚¢**         | âŒ    | SSH ã‚¢ã‚¯ã‚»ã‚¹ç”¨                    |

## ğŸ› ï¸ ä½¿ç”¨æ–¹æ³•

### 1. ğŸ“ åŸºæœ¬ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

```bash
# è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®æº–å‚™
cp terraform.tfvars.example terraform.tfvars

# è¨­å®šã‚’ç·¨é›†
vi terraform.tfvars
```

### 2. ğŸ“ å¿…é ˆè¨­å®šé …ç›®

```hcl
# èµ·å‹•ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆï¼ˆå¿…é ˆï¼‰
launch_template_id = "lt-0123456789abcdef0"

# ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåŸºæœ¬æƒ…å ±
project = "myproject"
env     = "dev"
app     = "web"

# AWSè¨­å®š
aws_region = "ap-northeast-1"
```

### 3. ğŸš€ ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆ

```bash
# åˆæœŸåŒ–
terraform init

# ãƒ—ãƒ©ãƒ³ã®ç¢ºèª
terraform plan

# é©ç”¨
terraform apply
```

### 4. ğŸ§ª ãƒ†ã‚¹ãƒˆï¼ˆæ¨å¥¨ï¼‰

```bash
# è‡ªå‹•ãƒ†ã‚¹ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒˆä½¿ç”¨
./test_module.sh validate   # è¨­å®šæ¤œè¨¼
./test_module.sh plan       # å®Ÿè¡Œè¨ˆç”»
./test_module.sh apply      # ãƒªã‚½ãƒ¼ã‚¹ä½œæˆ
./test_module.sh check      # çŠ¶æ…‹ç¢ºèª
./test_module.sh destroy    # ãƒªã‚½ãƒ¼ã‚¹å‰Šé™¤
```

## ğŸ“Š è¨­å®šé …ç›®

### ğŸ”‘ åŸºæœ¬è¨­å®š

| å¤‰æ•°å               | èª¬æ˜               | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤       | å¿…é ˆ |
| -------------------- | ------------------ | ------------------ | ---- |
| `launch_template_id` | èµ·å‹•ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆID | -                  | âœ…    |
| `project`            | ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå     | `"myproject"`      | âœ…    |
| `env`                | ç’°å¢ƒå             | `"dev"`            | âœ…    |
| `app`                | ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å | `""`               | âŒ    |
| `aws_region`         | AWSãƒªãƒ¼ã‚¸ãƒ§ãƒ³      | `"ap-northeast-1"` | âŒ    |

### ğŸ”„ ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°è¨­å®š

| å¤‰æ•°å                      | èª¬æ˜                             | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ | é–‹ç™ºç’°å¢ƒæ¨å¥¨ | æœ¬ç•ªç’°å¢ƒæ¨å¥¨ |
| --------------------------- | -------------------------------- | ---------- | ------------ | ------------ |
| `min_size`                  | æœ€å°ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹æ•°               | `0`        | `0`          | `2`          |
| `desired_capacity`          | å¸Œæœ›ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹æ•°               | `2`        | `1`          | `3`          |
| `max_size`                  | æœ€å¤§ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹æ•°               | è‡ªå‹•è¨ˆç®—   | `4`          | `10`         |
| `health_check_type`         | ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã‚¿ã‚¤ãƒ—             | `"EC2"`    | `"EC2"`      | `"ELB"`      |
| `health_check_grace_period` | ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯çŒ¶äºˆæœŸé–“ï¼ˆç§’ï¼‰     | `300`      | `300`        | `600`        |
| `default_cooldown`          | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚¯ãƒ¼ãƒ«ãƒ€ã‚¦ãƒ³æ™‚é–“ï¼ˆç§’ï¼‰ | `300`      | `300`        | `600`        |

### ğŸŒ ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯è¨­å®š

| å¤‰æ•°å                   | èª¬æ˜                         | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤             |
| ------------------------ | ---------------------------- | ------------------------ |
| `subnet_ids`             | ã‚µãƒ–ãƒãƒƒãƒˆIDãƒªã‚¹ãƒˆ           | `[]` (ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆVPCä½¿ç”¨) |
| `availability_zones`     | ã‚¢ãƒ™ã‚¤ãƒ©ãƒ“ãƒªãƒ†ã‚£ãƒ¼ã‚¾ãƒ¼ãƒ³     | `[]` (è‡ªå‹•é¸æŠ)          |
| `vpc_security_group_ids` | ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚°ãƒ«ãƒ¼ãƒ—IDãƒªã‚¹ãƒˆ | `[]`                     |

### ğŸ”” ç›£è¦–ãƒ»é€šçŸ¥è¨­å®š

| å¤‰æ•°å                         | èª¬æ˜                 | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ | æ¨å¥¨è¨­å®š             |
| ------------------------------ | -------------------- | ------------ | -------------------- |
| `enable_notifications`         | é€šçŸ¥ã®æœ‰åŠ¹/ç„¡åŠ¹      | `false`      | `true`               |
| `notification_email_addresses` | é€šçŸ¥å…ˆãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ | `[]`         | é‹ç”¨ãƒãƒ¼ãƒ ãƒ¡ãƒ¼ãƒ«     |
| `enable_cpu_high_alarm`        | CPUé«˜ä½¿ç”¨ç‡ã‚¢ãƒ©ãƒ¼ãƒ   | `true`       | `true`               |
| `cpu_high_threshold`           | CPUé«˜ä½¿ç”¨ç‡é–¾å€¤ï¼ˆ%ï¼‰ | `80`         | æœ¬ç•ª:`70`, é–‹ç™º:`80` |
| `enable_cpu_low_alarm`         | CPUä½ä½¿ç”¨ç‡ã‚¢ãƒ©ãƒ¼ãƒ   | `true`       | `true`               |
| `cpu_low_threshold`            | CPUä½ä½¿ç”¨ç‡é–¾å€¤ï¼ˆ%ï¼‰ | `10`         | æœ¬ç•ª:`20`, é–‹ç™º:`10` |

### ğŸ·ï¸ ã‚¿ã‚°è¨­å®š

| å¤‰æ•°å            | èª¬æ˜        | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ |
| ----------------- | ----------- | ------------ |
| `common_tags`     | å…±é€šã‚¿ã‚°    | `{}`         |
| `additional_tags` | ASGè¿½åŠ ã‚¿ã‚° | `{}`         |

## ğŸ’¡ ä½¿ç”¨ä¾‹

### ğŸ“š åŸºæœ¬çš„ãªä½¿ç”¨ä¾‹

```hcl
module "auto_scaling_group" {
  source = "./ec2/auto_scaling_group/terraform"

  # åŸºæœ¬è¨­å®š
  project = "myapp"
  env     = "dev"
  app     = "web"

  # èµ·å‹•ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
  launch_template_id = "lt-0123456789abcdef0"

  # ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°è¨­å®š
  min_size         = 0  # é–‹ç™ºç’°å¢ƒã§ã¯0å°ã‚¹ã‚±ãƒ¼ãƒ«ãƒ€ã‚¦ãƒ³
  desired_capacity = 2  # é€šå¸¸æ™‚ã¯2ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹
  max_size         = 8  # æœ€å¤§8ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹

  # å…±é€šã‚¿ã‚°
  common_tags = {
    Project     = "myapp"
    Environment = "dev"
    Owner       = "dev-team"
    ManagedBy   = "terraform"
  }
}
```

### ğŸ¢ æœ¬ç•ªç’°å¢ƒã§ã®ä½¿ç”¨ä¾‹

```hcl
module "auto_scaling_group_prod" {
  source = "./ec2/auto_scaling_group/terraform"

  # åŸºæœ¬è¨­å®š
  project = "webapp"
  env     = "prod"
  app     = "api"

  # èµ·å‹•ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
  launch_template_id = "lt-prod123456789abcdef0"

  # æœ¬ç•ªç’°å¢ƒç”¨ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°è¨­å®š
  min_size         = 3    # é«˜å¯ç”¨æ€§ç¢ºä¿
  desired_capacity = 5    # é€šå¸¸æ™‚ã¯5ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹
  max_size         = 20   # æœ€å¤§20ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹

  # æœ¬ç•ªç’°å¢ƒç”¨ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯è¨­å®š
  subnet_ids = [
    "subnet-12345678",  # ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã‚µãƒ–ãƒãƒƒãƒˆ
    "subnet-87654321",  # ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã‚µãƒ–ãƒãƒƒãƒˆ
    "subnet-11111111"   # ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã‚µãƒ–ãƒãƒƒãƒˆ
  ]

  # æœ¬ç•ªç’°å¢ƒç”¨ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
  health_check_type         = "ELB"
  health_check_grace_period = 600
  default_cooldown          = 900

  # é€šçŸ¥è¨­å®š
  enable_notifications = true
  notification_email_addresses = [
    "devops@company.com",
    "oncall@company.com"
  ]

  # æœ¬ç•ªç’°å¢ƒç”¨ã‚¢ãƒ©ãƒ¼ãƒ é–¾å€¤
  cpu_high_threshold = 70
  cpu_low_threshold  = 20

  # æœ¬ç•ªç’°å¢ƒç”¨ã‚¿ã‚°
  common_tags = {
    Project     = "webapp"
    Environment = "prod"
    Owner       = "devops-team"
    ManagedBy   = "terraform"
    CostCenter  = "engineering"
    Schedule    = "24x7"
  }
}
```

### ğŸ”— ALBçµ±åˆã®ä½¿ç”¨ä¾‹

```hcl
module "auto_scaling_group_alb" {
  source = "./ec2/auto_scaling_group/terraform"

  # åŸºæœ¬è¨­å®š
  project = "webapp"
  env     = "stg"
  app     = "web"

  # èµ·å‹•ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
  launch_template_id = "lt-web456789abcdef0"

  # ALBçµ±åˆç”¨è¨­å®š
  health_check_type         = "ELB"
  health_check_grace_period = 300
  target_group_arns = [
    "arn:aws:elasticloadbalancing:ap-northeast-1:123456789012:targetgroup/webapp-stg-web/1234567890abcdef"
  ]

  # ALBçµ±åˆç”¨ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°è¨­å®š
  min_size         = 2
  desired_capacity = 4
  max_size         = 12

  # è©³ç´°ç›£è¦–æœ‰åŠ¹åŒ–
  enable_detailed_monitoring = true

  # ALBçµ±åˆç”¨ã‚¿ã‚°
  common_tags = {
    Project     = "webapp"
    Environment = "stg"
    Owner       = "web-team"
    ManagedBy   = "terraform"
    LoadBalancer = "enabled"
  }
}
```

### ğŸ’° ã‚³ã‚¹ãƒˆæœ€é©åŒ–ã®ä½¿ç”¨ä¾‹

```hcl
module "auto_scaling_group_cost_optimized" {
  source = "./ec2/auto_scaling_group/terraform"

  # åŸºæœ¬è¨­å®š
  project = "testapp"
  env     = "dev"
  app     = "api"

  # èµ·å‹•ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
  launch_template_id = "lt-test789abcdef012345"

  # ã‚³ã‚¹ãƒˆæœ€é©åŒ–è¨­å®š
  min_size         = 0    # å¤œé–“ãƒ»é€±æœ«ã¯0å°
  desired_capacity = 1    # é€šå¸¸æ™‚ã¯æœ€å°é™
  max_size         = 3    # æœ€å¤§ã§ã‚‚3å°ã¾ã§

  # ã‚³ã‚¹ãƒˆæœ€é©åŒ–ç”¨ã‚¢ãƒ©ãƒ¼ãƒ é–¾å€¤
  cpu_high_threshold = 85  # é«˜ã‚ã«è¨­å®š
  cpu_low_threshold  = 5   # ä½ã‚ã«è¨­å®š

  # é–‹ç™ºç’°å¢ƒç”¨ã‚¿ã‚°
  common_tags = {
    Project     = "testapp"
    Environment = "dev"
    Owner       = "dev-team"
    ManagedBy   = "terraform"
    CostOptimization = "enabled"
    Schedule    = "business-hours"
  }
}
```

## ğŸ”” ç›£è¦–ãƒ»ã‚¢ãƒ©ãƒ¼ãƒˆè©³ç´°

### ğŸ“Š ä½œæˆã•ã‚Œã‚‹CloudWatchã‚¢ãƒ©ãƒ¼ãƒ 

| ã‚¢ãƒ©ãƒ¼ãƒ å       | ãƒ¡ãƒˆãƒªã‚¯ã‚¹     | é–¾å€¤ | èª¬æ˜                        |
| ---------------- | -------------- | ---- | --------------------------- |
| `CPUé«˜ä½¿ç”¨ç‡`    | CPUUtilization | 80%  | CPUä½¿ç”¨ç‡ãŒé«˜ã„æ™‚ã®ã‚¢ãƒ©ãƒ¼ãƒˆ |
| `CPUä½ä½¿ç”¨ç‡`    | CPUUtilization | 10%  | CPUä½¿ç”¨ç‡ãŒä½ã„æ™‚ã®ã‚¢ãƒ©ãƒ¼ãƒˆ |
| `ã‚¹ã‚±ãƒ¼ãƒ«ã‚¢ãƒƒãƒ—` | -              | -    | ã‚¹ã‚±ãƒ¼ãƒ«ã‚¢ãƒƒãƒ—å®Ÿè¡Œæ™‚ã®é€šçŸ¥  |
| `ã‚¹ã‚±ãƒ¼ãƒ«ãƒ€ã‚¦ãƒ³` | -              | -    | ã‚¹ã‚±ãƒ¼ãƒ«ãƒ€ã‚¦ãƒ³å®Ÿè¡Œæ™‚ã®é€šçŸ¥  |

### ğŸ“§ SNSé€šçŸ¥è¨­å®š

```hcl
# é€šçŸ¥è¨­å®šä¾‹
enable_notifications = true
notification_email_addresses = [
  "devops@company.com",
  "oncall@company.com",
  "team-slack-webhook@company.com"
]

# é€šçŸ¥å†…å®¹
# - ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ã‚¤ãƒ™ãƒ³ãƒˆ
# - ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹èµ·å‹•/çµ‚äº†
# - ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯å¤±æ•—
# - ã‚¢ãƒ©ãƒ¼ãƒ çŠ¶æ…‹å¤‰åŒ–
```

## ğŸ”§ ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ğŸ“‹ ã‚ˆãã‚ã‚‹å•é¡Œã¨è§£æ±ºæ–¹æ³•

| å•é¡Œ                         | åŸå›                      | è§£æ±ºæ–¹æ³•                           |
| ---------------------------- | ------------------------ | ---------------------------------- |
| **ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãŒèµ·å‹•ã—ãªã„** | èµ·å‹•ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®å•é¡Œ   | èµ·å‹•ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®è¨­å®šç¢ºèª         |
| **ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ãŒå‹•ä½œã—ãªã„** | CloudWatchã‚¢ãƒ©ãƒ¼ãƒ ã®å•é¡Œ | ã‚¢ãƒ©ãƒ¼ãƒ è¨­å®šãƒ»é–¾å€¤ç¢ºèª             |
| **ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ãŒå¤±æ•—ã™ã‚‹** | ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®å•é¡Œ   | ãƒ­ã‚°ç¢ºèªãƒ»ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯è¨­å®šè¦‹ç›´ã— |
| **é€šçŸ¥ãŒå±Šã‹ãªã„**           | SNSãƒˆãƒ”ãƒƒã‚¯ã®å•é¡Œ        | SNSè¨­å®šãƒ»ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ç¢ºèª        |

### ğŸ” ãƒ‡ãƒãƒƒã‚°æ‰‹é †

```bash
# 1. Auto Scaling GroupçŠ¶æ…‹ç¢ºèª
aws autoscaling describe-auto-scaling-groups \
  --auto-scaling-group-names "${PROJECT}-${ENV}-${APP}-asg"

# 2. ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹çŠ¶æ…‹ç¢ºèª
aws ec2 describe-instances \
  --filters "Name=tag:aws:autoscaling:groupName,Values=${PROJECT}-${ENV}-${APP}-asg"

# 3. CloudWatchã‚¢ãƒ©ãƒ¼ãƒ ç¢ºèª
aws cloudwatch describe-alarms \
  --alarm-names "${PROJECT}-${ENV}-${APP}-cpu-high"

# 4. ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°å±¥æ­´ç¢ºèª
aws autoscaling describe-scaling-activities \
  --auto-scaling-group-name "${PROJECT}-${ENV}-${APP}-asg"

# 5. ãƒ­ã‚°ç¢ºèª
aws logs describe-log-groups \
  --log-group-name-prefix "/aws/autoscaling/${PROJECT}-${ENV}-${APP}"
```

### ğŸ› ï¸ è¨­å®šèª¿æ•´ã®ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³

**ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–:**
```hcl
# é«˜è² è·å¯¾å¿œ
default_cooldown = 600        # ã‚¯ãƒ¼ãƒ«ãƒ€ã‚¦ãƒ³æ™‚é–“å»¶é•·
cpu_high_threshold = 60       # é–¾å€¤ã‚’ä¸‹ã’ã¦æ—©æœŸå¯¾å¿œ
health_check_grace_period = 900  # çŒ¶äºˆæœŸé–“å»¶é•·
```

**ã‚³ã‚¹ãƒˆæœ€é©åŒ–:**
```hcl
# ä½ã‚³ã‚¹ãƒˆé‹ç”¨
min_size = 0                  # å¤œé–“ãƒ»é€±æœ«ã¯0å°
cpu_low_threshold = 5         # ä½ã„é–¾å€¤ã§ã‚¹ã‚±ãƒ¼ãƒ«ãƒ€ã‚¦ãƒ³
default_cooldown = 300        # çŸ­ã„ã‚¯ãƒ¼ãƒ«ãƒ€ã‚¦ãƒ³æ™‚é–“
```

## ğŸ“ˆ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

### ğŸ¯ ç’°å¢ƒåˆ¥æ¨å¥¨è¨­å®š

```hcl
# é–‹ç™ºç’°å¢ƒï¼ˆã‚³ã‚¹ãƒˆé‡è¦–ï¼‰
locals {
  dev_config = {
    min_size                = 0
    desired_capacity        = 1
    max_size               = 4
    cpu_high_threshold     = 85
    cpu_low_threshold      = 5
    health_check_grace_period = 300
    default_cooldown       = 300
  }
}

# æœ¬ç•ªç’°å¢ƒï¼ˆå¯ç”¨æ€§é‡è¦–ï¼‰
locals {
  prod_config = {
    min_size                = 3
    desired_capacity        = 5
    max_size               = 20
    cpu_high_threshold     = 60
    cpu_low_threshold      = 20
    health_check_grace_period = 600
    default_cooldown       = 900
  }
}
```

### ğŸ”„ ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ãƒãƒªã‚·ãƒ¼æœ€é©åŒ–

```hcl
# ã‚¿ãƒ¼ã‚²ãƒƒãƒˆè¿½è·¡ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ï¼ˆæ¨å¥¨ï¼‰
resource "aws_autoscaling_policy" "target_tracking" {
  name                   = "${var.project}-${var.env}-${var.app}-target-tracking"
  scaling_adjustment     = 0
  adjustment_type        = "ChangeInCapacity"
  cooldown              = 300
  autoscaling_group_name = aws_autoscaling_group.main.name
  policy_type           = "TargetTrackingScaling"

  target_tracking_configuration {
    predefined_metric_specification {
      predefined_metric_type = "ASGAverageCPUUtilization"
    }
    target_value = 70.0
    scale_out_cooldown = 300
    scale_in_cooldown  = 300
  }
}
```

## ğŸ”— å‡ºåŠ›å€¤

| å‡ºåŠ›å                   | èª¬æ˜                           |
| ------------------------ | ------------------------------ |
| `autoscaling_group_id`   | Auto Scaling Group ID          |
| `autoscaling_group_name` | Auto Scaling Groupå           |
| `autoscaling_group_arn`  | Auto Scaling Group ARN         |
| `sns_topic_arn`          | SNS ãƒˆãƒ”ãƒƒã‚¯ ARN               |
| `cloudwatch_alarm_arns`  | CloudWatch ã‚¢ãƒ©ãƒ¼ãƒ  ARN ãƒªã‚¹ãƒˆ |

## ğŸ“ ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

ã“ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¯[MIT License](LICENSE)ã®ä¸‹ã§æä¾›ã•ã‚Œã¦ã„ã¾ã™ã€‚

---

**æœ€çµ‚æ›´æ–°**: 2024å¹´12æœˆ
**å‹•ä½œç¢ºèª**: Terraform 1.0+, AWS Provider 5.x
**ãƒ†ã‚¹ãƒˆçŠ¶æ³**: å…¨æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆæ¸ˆã¿
