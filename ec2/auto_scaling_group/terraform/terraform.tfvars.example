# ==================================================
# プロジェクト基本設定
# ==================================================

# AWSリージョン
aws_region = "ap-northeast-1"

# プロジェクト名
project = "myproject"

# 環境名（dev, stg, prodなど）
env = "dev"

# アプリケーション名（オプション）
app = "web"

# ==================================================
# 起動テンプレート設定
# ==================================================

# 使用する起動テンプレートのID（必須）
# 例: "lt-0123456789abcdef0"
launch_template_id = "REPLACE_WITH_YOUR_LAUNCH_TEMPLATE_ID"

# 起動テンプレートのバージョン
launch_template_version = "$Latest"

# ==================================================
# ネットワーク設定
# ==================================================

# サブネットIDのリスト（オプション：空の場合はデフォルトVPCのサブネットを使用）
# subnet_ids = ["subnet-12345678", "subnet-87654321"]

# アベイラビリティーゾーンのリスト（オプション：空の場合は利用可能なすべてのAZを使用）
# availability_zones = ["ap-northeast-1a", "ap-northeast-1c"]

# ==================================================
# オートスケーリンググループ基本設定
# ==================================================

# インスタンス数設定
# 最小インスタンス数（0に設定することで完全なスケールダウンが可能）
min_size = 0

# 希望インスタンス数（最大インスタンス数は希望インスタンス数の2倍に自動設定されます）
desired_capacity = 2

# ヘルスチェック設定
health_check_type         = "EC2"  # EC2 または ELB
health_check_grace_period = 300

# その他の設定
protect_from_scale_in = false
default_cooldown      = 300
max_instance_lifetime = 0  # 0 = 制限なし

# 終了ポリシー
termination_policies = ["Default"]

# ==================================================
# ロードバランサー設定（オプション）
# ==================================================

# ALB/NLBのターゲットグループARN（オプション）
# target_group_arns = ["arn:aws:elasticloadbalancing:ap-northeast-1:123456789012:targetgroup/my-target-group/1234567890123456"]

# クラシックロードバランサー名（オプション）
# load_balancer_names = ["my-classic-lb"]

# ==================================================
# 通知設定
# ==================================================

# 通知を有効にするかどうか
enable_notifications = true

# 通知先メールアドレス
notification_email_addresses = [
  "admin@example.com",
  "devops@example.com"
]

# SNSトピック暗号化用のKMS key ID（オプション）
# 指定された場合、SNSトピックのメッセージが暗号化されます
# sns_kms_key_id = "arn:aws:kms:ap-northeast-1:123456789012:key/12345678-1234-1234-1234-123456789012"
# または key ID: "12345678-1234-1234-1234-123456789012"
# または alias: "alias/sns-key"

# 通知タイプ
notification_types = [
  "autoscaling:EC2_INSTANCE_LAUNCH",
  "autoscaling:EC2_INSTANCE_LAUNCH_ERROR",
  "autoscaling:EC2_INSTANCE_TERMINATE",
  "autoscaling:EC2_INSTANCE_TERMINATE_ERROR"
]

# ==================================================
# メトリクス設定
# ==================================================

# 有効にするメトリクス
enabled_metrics = [
  "GroupMinSize",
  "GroupMaxSize",
  "GroupDesiredCapacity",
  "GroupInServiceInstances",
  "GroupTotalInstances"
]

# ==================================================
# インスタンスリフレッシュ設定
# ==================================================

# インスタンスリフレッシュを有効にするかどうか
enable_instance_refresh = false

# リフレッシュ設定（enable_instance_refresh = true の場合）
# instance_refresh_strategy = "Rolling"
# instance_refresh_min_healthy_percentage = 90
# instance_refresh_instance_warmup = 300

# ==================================================
# CPU監視アラーム設定
# ==================================================

# CPU使用率高アラーム
enable_cpu_high_alarm      = true
cpu_high_threshold         = 80
cpu_high_evaluation_periods = 2
cpu_high_period           = 120

# CPU使用率低アラーム
enable_cpu_low_alarm       = true
cpu_low_threshold          = 10
cpu_low_evaluation_periods = 2
cpu_low_period            = 120

# ==================================================
# スケーリングポリシー設定
# ==================================================

# スケールアップポリシー
enable_scale_up_policy    = true
scale_up_adjustment      = 1
scale_up_adjustment_type = "ChangeInCapacity"
scale_up_cooldown        = 300
scale_up_policy_type     = "SimpleScaling"

# スケールダウンポリシー
enable_scale_down_policy    = true
scale_down_adjustment      = -1
scale_down_adjustment_type = "ChangeInCapacity"
scale_down_cooldown        = 300
scale_down_policy_type     = "SimpleScaling"

# ==================================================
# ターゲット追跡スケーリング設定（オプション）
# ==================================================

# ターゲット追跡スケーリングを使用する場合
# scale_up_policy_type = "TargetTrackingScaling"
# target_tracking_target_value = 50.0
# target_tracking_metric_type = "ASGAverageCPUUtilization"

# ==================================================
# スケーリングアラーム設定
# ==================================================

# スケールアップアラーム
enable_scale_up_alarm      = true
scale_up_alarm_threshold   = 70
scale_up_alarm_evaluation_periods = 2
scale_up_alarm_period      = 120

# スケールダウンアラーム
enable_scale_down_alarm     = true
scale_down_alarm_threshold  = 20
scale_down_alarm_evaluation_periods = 2
scale_down_alarm_period     = 120

# ==================================================
# タグ設定
# ==================================================

# 共通タグ
common_tags = {
  Environment = "dev"
  Project     = "myproject"
  Owner       = "DevOps Team"
  CostCenter  = "Engineering"
}

# 追加タグ（インスタンスにプロパゲートするかどうかを指定）
additional_tags = {
  "Backup" = {
    value               = "daily"
    propagate_at_launch = true
  }
  "Monitoring" = {
    value               = "enabled"
    propagate_at_launch = true
  }
}
